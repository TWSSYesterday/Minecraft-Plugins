var MinecraftPlugins={loaded:false,data:null,default_server_type:"bukkit",website_base:"//www.minecraft-plugins.com/",init:function(){MinecraftPlugins.bukget_base_url="//api.bukget.org/3/";MinecraftPlugins.spinner=new Spinner;MinecraftPlugins.populateSearchSuggestions(MinecraftPlugins.getServerType());window.onload=function(){var plugin_name=MinecraftPlugins.getParameterByName("plugin_name");var server_type=MinecraftPlugins.getParameterByName("server_type")||MinecraftPlugins.default_server_type;if(plugin_name){$("#input-plugin-name").val(plugin_name);$("#input-server-type").val(server_type);MinecraftPlugins.search(plugin_name,server_type)}};$("#search-form").submit(function(){var name=$("#input-plugin-name").val();if(name===undefined||name===""){MinecraftPlugins.loadError("Plugin must not be empty.");return false}})},clearData:function(){$("#plugin-name").empty();$("#plugin-author").empty();$("#plugin-latest-version").empty();$("#plugin-description").empty();$("#plugin-website").attr("href","#");$("#plugin-repo-page").attr("href","#");$("#plugin-latest-download").attr("href","#");$("#download-table > tbody").empty()},getPluginData:function(slug,type,callback){var url=MinecraftPlugins.bukget_base_url+"plugins/"+type+"/"+slug;var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200)callback(JSON.parse(xhr.responseText));if(xhr.status===404)MinecraftPlugins.loadError("Could not load plugin data.")}};xhr.open("GET",url,true);xhr.send()},getPluginSlug:function(name,type,callback){var url=MinecraftPlugins.bukget_base_url+"search/plugin_name/like/"+name+"?fields=slug,plugin_name";var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){var data=JSON.parse(xhr.responseText);var slug=null;for(var i in data){if(data[i].plugin_name.toLowerCase()===MinecraftPlugins.getPluginName().toLowerCase()){slug=data[i].slug}}if(typeof data[0]==="undefined"){MinecraftPlugins.loadError("Plugin does not exist.")}else{callback(slug,type,MinecraftPlugins.populateData)}}if(xhr.status===404)MinecraftPlugins.loadError("Plugin does not exist.")}};xhr.open("GET",url,true);xhr.send()},getParameterByName:function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results===null?"":decodeURIComponent(results[1].replace(/\+/g," "))},getPluginName:function(){return $("#input-plugin-name").val()},getServerType:function(){return $("#input-server-type :selected").val()},populateData:function(data){MinecraftPlugins.data=data;$("#plugin-name").html(data.plugin_name||"");$("#plugin-author").html(data.authors||"");$("#plugin-latest-version").html(data.versions[0].version||"");$("#plugin-description").html(data.description||"");$("#plugin-website").attr("href",data.website||"");$("#plugin-repo-page").attr("href",data.dbo_page||"");$("#plugin-latest-download").attr("href",data.versions[0].download||"");$("#plugin-logo").attr("href",data.logo_full||"resources/images/default.jpg");$("#plugin-logo img").attr("src",data.logo_full||"resources/images/default.jpg");for(var i=0;i<data.versions.length;i++){var changelog_button=$("<a>",{"class":"btn btn-primary btn-sm btn-block btn-changelog",text:"Changelog"});var download_button=$("<a>",{href:data.versions[i].download,"class":"btn btn-primary btn-sm btn-block",html:"<i class='icon fa fa-download'></i>Download"});$("#download-table").find("tbody").append($("<tr id='trr-"+i+"'>").append($("<td>").text(data.versions[i].version)).append($("<td>").text(data.versions[i].filename)).append($("<td>").append(changelog_button)).append($("<td>").append(download_button)))}$(".btn-changelog").click(function(){var index=$(this).closest("td").parent()[0].sectionRowIndex;$("#changelog-title").text(MinecraftPlugins.data.versions[index].version);$("#changelog-body").html(atob(MinecraftPlugins.data.versions[index].changelog));$("#changelog-modal").modal("show")});MinecraftPlugins.loadSuccess()},populateSearchSuggestions:function(server_type){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){var data=JSON.parse(xhr.responseText);$("#input-plugin-name").autocomplete({lookup:data.suggestions,autoSelectFirst:true,deferRequestBy:100})}};xhr.open("GET",MinecraftPlugins.website_base+server_type+"-plugins.json",true);xhr.send()},search:function(name,type){MinecraftPlugins.startLoading();var plugin_name=name||MinecraftPlugins.getPluginName();var server_type=type||MinecraftPlugins.getServerType().toLowerCase();if(plugin_name===undefined||plugin_name===""){MinecraftPlugins.loadError("Plugin must not be empty.")}else if(server_type===undefined||server_type===""){MinecraftPlugins.loadError("Server Type must not be empty.")}else{MinecraftPlugins.getPluginSlug(plugin_name,server_type,MinecraftPlugins.getPluginData)}},startLoading:function(){$(".alert").slice(0).remove();if(MinecraftPlugins.loaded){$(".plugin-details").fadeOut("fast");MinecraftPlugins.clearData();MinecraftPlugins.data=null}MinecraftPlugins.spinner.spin(document.getElementById("spinner"))},loadSuccess:function(){MinecraftPlugins.loaded=true;MinecraftPlugins.spinner.stop();$(".plugin-details").fadeIn("fast")},loadError:function(msg){MinecraftPlugins.loaded=false;MinecraftPlugins.spinner.stop();$(".plugin-details").fadeOut("fast");var alert=$("<div>",{"class":"alert alert-danger",role:"alert",html:"<a href='#' class='close' data-dismiss='alert'>&times;</a>"+msg});$(".alert").slice(0).remove();$("#error").append(alert)}};