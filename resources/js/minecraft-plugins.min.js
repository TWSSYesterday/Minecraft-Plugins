var MinecraftPlugins={loaded:false,data:null,default_server_type:"bukkit",website_base:"http://www.minecraft-plugins.com/",init:function(){MinecraftPlugins.bukget_base_url="http://api.bukget.org/3/";MinecraftPlugins.spinner=new Spinner;MinecraftPlugins.populateSearchSuggestions(MinecraftPlugins.getServerType());window.onload=function(){var e=MinecraftPlugins.getParameterByName("plugin_name");var n=MinecraftPlugins.getParameterByName("server_type")||MinecraftPlugins.default_server_type;if(e){$("#input-plugin-name").val(e);$("#input-server-type").val(n);MinecraftPlugins.search(e,n)}};$("#search-form").submit(function(){var e=$("#input-plugin-name").val();if(e===undefined||e===""){MinecraftPlugins.loadError("Plugin must not be empty.");return false}})},clearData:function(){$("#plugin-name").empty();$("#plugin-author").empty();$("#plugin-latest-version").empty();$("#plugin-description").empty();$("#plugin-website").attr("href","#");$("#plugin-repo-page").attr("href","#");$("#plugin-latest-download").attr("href","#");$("#download-table > tbody").empty()},getPluginData:function(e,n,t){var a=MinecraftPlugins.bukget_base_url+"plugins/"+n+"/"+e;var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status===200)t(JSON.parse(i.responseText));if(i.status===404)MinecraftPlugins.loadError("Could not load plugin data.")}};i.open("GET",a,true);i.send()},getPluginSlug:function(e,n,t){var a=MinecraftPlugins.bukget_base_url+"search/plugin_name/like/"+e+"?fields=slug,plugin_name";var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status===200){var e=JSON.parse(i.responseText);var a=null;for(var r in e){if(e[r].plugin_name.toLowerCase()===MinecraftPlugins.getPluginName().toLowerCase()){a=e[r].slug}}if(typeof e[0]==="undefined"){MinecraftPlugins.loadError("Plugin does not exist.")}else{t(a,n,MinecraftPlugins.populateData)}}if(i.status===404)MinecraftPlugins.loadError("Plugin does not exist.")}};i.open("GET",a,true);i.send()},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),t=n.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))},getPluginName:function(){return $("#input-plugin-name").val()},getServerType:function(){return $("#input-server-type :selected").val()},populateData:function(e){MinecraftPlugins.data=e;$("#plugin-name").html(e.plugin_name||"");$("#plugin-author").html(e.authors||"");$("#plugin-latest-version").html(e.versions[0].version||"");$("#plugin-description").html(e.description||"");$("#plugin-website").attr("href",e.website||"");$("#plugin-repo-page").attr("href",e.dbo_page||"");$("#plugin-latest-download").attr("href",e.versions[0].download||"");$("#plugin-logo").attr("href",e.logo_full||"resources/images/default.jpg");$("#plugin-logo img").attr("src",e.logo_full||"resources/images/default.jpg");for(var n=0;n<e.versions.length;n++){var t=$("<a>",{"class":"btn btn-primary btn-sm btn-block btn-changelog",text:"Changelog"});var a=$("<a>",{href:e.versions[n].download,"class":"btn btn-primary btn-sm btn-block",html:"<i class='icon fa fa-download'></i>Download"});$("#download-table").find("tbody").append($("<tr id='trr-"+n+"'>").append($("<td>").text(e.versions[n].version)).append($("<td>").text(e.versions[n].filename)).append($("<td>").append(t)).append($("<td>").append(a)))}$(".btn-changelog").click(function(){var e=$(this).closest("td").parent()[0].sectionRowIndex;$("#changelog-title").text(MinecraftPlugins.data.versions[e].version);$("#changelog-body").html(atob(MinecraftPlugins.data.versions[e].changelog));$("#changelog-modal").modal("show")});MinecraftPlugins.loadSuccess()},populateSearchSuggestions:function(e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===4&&n.status===200){var e=JSON.parse(n.responseText);$("#input-plugin-name").autocomplete({lookup:e.suggestions,autoSelectFirst:true,deferRequestBy:100})}};n.open("GET",MinecraftPlugins.website_base+e+"-plugins.json",true);n.send()},search:function(e,n){MinecraftPlugins.startLoading();var t=e||MinecraftPlugins.getPluginName();var a=n||MinecraftPlugins.getServerType().toLowerCase();if(t===undefined||t===""){MinecraftPlugins.loadError("Plugin must not be empty.")}else if(a===undefined||a===""){MinecraftPlugins.loadError("Server Type must not be empty.")}else{MinecraftPlugins.getPluginSlug(t,a,MinecraftPlugins.getPluginData)}},startLoading:function(){$(".alert").slice(0).remove();if(MinecraftPlugins.loaded){$(".plugin-details").fadeOut("fast");MinecraftPlugins.clearData();MinecraftPlugins.data=null}MinecraftPlugins.spinner.spin(document.getElementById("spinner"))},loadSuccess:function(){MinecraftPlugins.loaded=true;MinecraftPlugins.spinner.stop();$(".plugin-details").fadeIn("fast")},loadError:function(e){MinecraftPlugins.loaded=false;MinecraftPlugins.spinner.stop();$(".plugin-details").fadeOut("fast");var n=$("<div>",{"class":"alert alert-danger",role:"alert",html:"<a href='#' class='close' data-dismiss='alert'>&times;</a>"+e});$(".alert").slice(0).remove();$("#error").append(n)}};